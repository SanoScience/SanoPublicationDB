<div class="mb-3">
    <%= link_to publications_path, class: "text-decoration-none text-muted small d-inline-flex align-items-center gap-1 fs-6" do %>
        <i class="bi bi-arrow-left"></i> Back
    <% end %>
</div>

<div class="row">
    <div class="col-md-10">
        <h2><%= @publication.title %></h2>
    </div>

    <div class="col-md-2">
        <div class="d-grid gap-2">
            <%= link_to "Edit publication", edit_publication_path(@publication), class: 'btn btn-primary' %>

            <%= button_to "Delete", publication_path(@publication),
                method: :delete,
                data: { confirm: "Are you sure?" },
                form: { class: "d-grid" },
                class: "btn btn-danger" %>
        </div>
    </div>
</div>

<div class="d-flex flex-wrap gap-2 mb-5">
    <% status_class = case @publication.status
        when "submitted" then "bg-warning text-dark"
        when "accepted"  then "bg-info text-dark"
        when "printed"   then "bg-success text-white"
        else "bg-secondary text-white"
    end %>
    <span class="badge <%= status_class %> px-3 py-2 fs-6">
        <%= @publication.status.humanize %>
    </span>

    <span class="badge bg-light text-dark border px-3 py-2 fs-6">
        <%= @publication.category.humanize %>
    </span>
</div>

<div class="d-flex gap-2 mb-3">
    <strong>Authors:</strong> <%= @publication.author_list %>
</div>

<div class="d-flex gap-2 mb-5">
    <strong>Link:</strong> <%= link_to truncate(@publication.link, length: 80), @publication.link, target: "_blank", rel: "noopener", class: "text-break d-inline-block" %>
</div>

<h4>Research Groups</h4>
<ul>
  <% @publication.research_group_publications.each do |group| %>
    <li>
      <p>
        <% if group.is_primary %>
            <strong>ðŸŒŸ <%= group.research_group.name %> (Primary)</strong>
        <% else %>
          <%= group.research_group.name %>
        <% end %>
      </p>
    </li>
  <% end %>
</ul>

<% if @publication.identifiers.any? %>
    <hr>
    <h4>Identifiers</h4>
    <ul>
        <% @publication.identifiers.each do |identifier| %>
            <li>
                <p><strong><%= identifier.category.upcase %>:</strong> <%= identifier.value %></p>
            </li>
        <% end %>
    </ul>
<% end %>

<% if @publication.repository_links.any? %>
    <hr>
    <h4>Repository Links</h4>
    <ul>
        <% @publication.repository_links.each do |repo_link| %>
            <li>
                <p>
                    <strong><%= repo_link.repository.humanize %>:</strong> 
                    <%= link_to repo_link.value, repo_link.value, target: "_blank" %>
                </p>
            </li>
        <% end %>
    </ul>
<% end %>

<% if @publication.conference %>
    <hr>
    <h4>Conference</h4>
    <ul>
        <p><strong>Name:</strong> <%= @publication.conference.name %></p>
        <% if @publication.conference.core %>
            <p><strong>CORE:</strong> <%= @publication.conference.core %></p>
        <% end %>
        <% if @publication.conference.start_date && @publication.conference.end_date %>
            <p><strong>Dates:</strong> <%= @publication.conference.start_date %> - <%= @publication.conference.end_date %></p>
        <% end %>
    </ul>
<% end %>

<% if @publication.journal_issue %>
    <hr>
    <h4>Journal Issue</h4>
    <ul>
        <p><strong>Title:</strong> <%= @publication.journal_issue.title %></p>
        <% if @publication.journal_issue.publisher %>
            <p><strong>Published by:</strong> <%= @publication.journal_issue.publisher %></p>
        <% end %>
        <% if @publication.journal_issue.journal_num %>
            <p><strong>Number:</strong> <%= @publication.journal_issue.journal_num %></p>
        <% end %>
        <% if @publication.journal_issue.volume %>
            <p><strong>Volume:</strong> <%= @publication.journal_issue.volume %></p>
        <% end %>
        <% if @publication.journal_issue.impact_factor %>
            <p><strong>Impact factor:</strong> <%= @publication.journal_issue.impact_factor %></p>
        <% end %>
    </ul>
<% end %>

<% if @publication.kpi_reporting_extension %>
    <hr>
    <h4>KPI Reporting Information</h4>
    <ul>
        <% if @publication.kpi_reporting_extension.teaming_reporting_period %>
            <p><strong>Teaming reporting period:</strong> <%= @publication.kpi_reporting_extension.teaming_reporting_period %></p>
        <% end %>
        <% if @publication.kpi_reporting_extension.invoice_number %>
            <p><strong>Invoice number Reporting:</strong> <%= @publication.kpi_reporting_extension.invoice_number %></p>
        <% end %>
        <% if @publication.kpi_reporting_extension.pbn %>
            <p><strong>PBN:</strong> <%= @publication.kpi_reporting_extension.pbn %></p>
        <% end %>
        <% if @publication.kpi_reporting_extension.jcr %>
            <p><strong>JCR:</strong> <%= @publication.kpi_reporting_extension.jcr %></p>
        <% end %>
        <% if @publication.kpi_reporting_extension.is_added_ft_portal %>
            <p><strong>Is added on F&T portal:</strong> <%= @publication.kpi_reporting_extension.is_added_ft_portal %></p>
        <% end %>
        <% if @publication.kpi_reporting_extension.is_checked %>
            <p><strong>Is checked:</strong> <%= @publication.kpi_reporting_extension.is_checked %></p>
        <% end %>
        <% if @publication.kpi_reporting_extension.is_new_method_technique %>
            <p><strong>Does publication describe new methods and techniques:</strong> <%= @publication.kpi_reporting_extension.is_new_method_technique %></p>
        <% end %>
        <% if @publication.kpi_reporting_extension.is_methodology_application %>
            <p><strong>Does publication describe application of the methodology:</strong> <%= @publication.kpi_reporting_extension.is_methodology_application %></p>
        <% end %>
        <% if @publication.kpi_reporting_extension.is_polish_med_researcher_involved %>
            <p><strong>Is Polish medical researchers involved:</strong> <%= @publication.kpi_reporting_extension.is_polish_med_researcher_involved %></p>
        <% end %>
        <% if @publication.kpi_reporting_extension.subsidy_points %>
            <p><strong>Subsidy points:</strong> <%= @publication.kpi_reporting_extension.subsidy_points %></p>
        <% end %>
        <% if @publication.kpi_reporting_extension.updated_at %>
            <p><strong>Last update:</strong> <%= @publication.kpi_reporting_extension.updated_at %></p>
        <% end %>
    </ul>
<% end %>

<% if @publication.open_access_extension %>
    <hr>
    <h4>Open Access Details</h4>
    <ul>
        <p><strong>Open Access:</strong> <%= @publication.open_access_extension.category.humanize %></p>
        <% if @publication.open_access_extension.gold? %>
            <p> <strong>Gold OA Charges:</strong> <%= @publication.open_access_extension.gold_oa_charges %></p>
            <p> <strong>Funding Source:</strong> <%= @publication.open_access_extension.gold_oa_funding_source %></p>
        <% end %>
    </ul>
<% end %>

<hr>
